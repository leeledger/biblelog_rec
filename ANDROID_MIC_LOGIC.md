# 🎤 Android Microphone Recognition Logic Spec (v1.0)

안드로이드 환경에서 안정적이고 끊김 없는 성경 읽기 경험을 제공하기 위한 특화된 마이크 제어 및 복구 로직에 대한 명세입니다.

---

## 1. 핵심 설계 철학 (Core Philosophy)
안드로이드 크롬 브라우저의 음성 인식 엔진은 자원 반납이 늦고, 장시간 사용 시 메모리 파편화로 인해 먹통이 되는 고질적인 이슈가 있습니다. 이를 해결하기 위해 **"정확한 상태 감지"**와 **"강제 복구 메커니즘"**을 결합했습니다.

## 2. 3단계 하드 리셋 로직 (Three-Step Hard Reset)
구절이 전환될 때마다 이전 구절의 잔상(Ghost Transcript)이 남지 않도록 엔진을 완전히 초기화합니다.

1.  **Delay Abort:** 구절 매칭 성공 시 즉시 끊지 않고 `200ms`의 지연을 둡니다. 이는 안드로이드 엔진이 마지막 단어를 처리할 물리적 시간을 확보하기 위함입니다.
2.  **Abort Command:** `recognition.abort()`를 호출하여 엔진 버퍼를 즉시 파기합니다.
3.  **Wait for onend:** 브라우저가 자원을 완전히 해제했다는 신호(`onend`)를 보낼 때까지 대기하며, `isListening` 상태가 `false`가 된 것을 확인한 후 다시 `start()`를 호출합니다.

## 3. 마이크 와치독 시스템 (Microphone Watchdog)
사용자가 마이크가 꺼진 줄 모르고 계속 읽는 "헛수고"를 방지하기 위한 자동 감시 시스템입니다.

-   **감시 로직:** 통독 상태(`LISTENING`)인데 마이크 활성 상태(`isListening`)가 `false`로 3초 이상 지속될 경우 트리거됩니다.
-   **자동 복구:** 지연이 감지되면 앱이 내부적으로 `startListening()`을 한 번 더 강제 호출하여 엔진을 깨웁니다.
-   **수동 복구 패널:** 자동 복구 시도와 동시에 사용자에게 **[마이크 다시 깨우기]** 버튼을 노출하여 심리적 불안감을 해소합니다.

## 4. 시각적 유도 시스템 (Visual Feedback)
마이크 상태와 사용자 행동을 동기화하여 인지적 피로도를 낮춥니다.

-   **Ghost Reading 방지 (Opacity):** 마이크가 실제 준비되지 않은 상태(`isListening: false`)에서는 성경 구절의 투명도를 `30%`로 낮춰 사용자가 무의식적으로 읽기를 멈추고 대기하도록 유도합니다.
-   **실시간 상태 표시등:**
    -   `● 마이크 활성 중 (초록)` : 안심하고 읽어도 되는 상태
    -   `● 마이크 연결 중 (빨강 + 애니메이션)` : 시스템 지연이 발생 중임을 직관적으로 전달

## 5. 지능형 패스키 (Dynamic Amen Pass)
음성 인식이 도저히 불가능한 환경(소음, 발음 문제 등)을 대비한 탈출구입니다.

-   **동적 타이머:** `5초 + (글자 수 × 0.2초)` 공식을 통해 구절 길이에 비례한 대기 시간을 제공합니다. (최대 45초)
-   **아멘 트리거:** 일정 시간 노출되는 안내에 따라 사용자가 "아멘"이라고 발음하면 수동 조작 없이 다음 구절로 안전하게 넘어갑니다.

## 6. 자원 완전 초기화 (Full Resource Clean)
세션이 종료될 때 단순히 상태만 바꾸는 것이 아니라 `window.location.reload()`를 통해 브라우저의 STT 엔진 리소스를 완전히 메모리에서 해제하여 다음 세션의 지연을 원천 봉쇄합니다.

---

*이 문서는 안드로이드 환경에서의 수많은 테스트와 디버그 로그 분석을 통해 검증된 최적의 로직을 바탕으로 작성되었습니다.*
